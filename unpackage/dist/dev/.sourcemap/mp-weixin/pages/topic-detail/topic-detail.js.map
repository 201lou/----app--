{"version":3,"file":"topic-detail.js","sources":["pages/topic-detail/topic-detail.vue","../../AppGallery/HBuilderX.4.75.2025070414-alpha/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdG9waWMtZGV0YWlsL3RvcGljLWRldGFpbC52dWU"],"sourcesContent":["<template>\n\t<view>\n\t\t<topic-info :info=\"info\"></topic-info>\r\n\t\t<view class=\"divider\"></view>\r\n\t\t<!-- 置顶帖子 -->\r\n\t\t<view class=\"p-2 flex align-center border-bottom\" hover-class=\"bg-light\"\r\n\t\tv-for=\"(item,index) in hotpost\" :key=\"index\">\r\n\t\t\t<text class=\"iconfont icon-xihuan color-global\"></text>\r\n\t\t\t<text class=\"font text-dark text-ellipsis\">\r\n\t\t\t\t{{item.title}}\r\n\t\t\t</text>\r\n\t\t</view>\t\t\r\n\t\t<view class=\"divider\"></view>\r\n\t\t<!-- tab -->\r\n\t\t<view class=\"flex align-center py-2\">\r\n\t\t\t<view class=\"flex-1 flex align-center justify-center\" \r\n\t\t\tv-for=\"(item,index) in tabBars\" :key=\"index\" \r\n\t\t\t:class=\"index === tabIndex ? 'font-lg font-weight-bold color-global': 'font-md'\"\r\n\t\t\t@click=\"changeTab(index)\">{{item.name}}</view>\r\n\t\t</view>\r\n\t\t<!-- 列表 -->\r\n\t\t<template v-if=\"listData.length > 0\">\r\n\t\t<block v-for=\"(item,index) in listData\" :key=\"index\">\r\n\t\t\t<common-list :item=\"item\" :index=\"index\"></common-list>\r\n\t\t\t<view class=\"divider\"></view>\r\n\t\t</block>\r\n\t\t</template>\r\n\t\t<template v-else>\r\n\t\t\t<no-thing></no-thing>\r\n\t\t</template>\r\n\t\t<!-- 上拉加载 -->\r\n\t\t<load-more :loadmore=\"loadtext\"></load-more>\n\t</view>\n</template>\n\n<script>\r\n\timport topicInfo from '@/components/topic-detail/topic-info.vue';\r\n\timport commonList from '@/components/common/common-list.vue';\r\n\timport noThing from '@/components/common/no-thing.vue';\r\n\timport loadMore from '@/components/common/load-more.vue';\n\texport default {\r\n\t\tcomponents:{\r\n\t\t\ttopicInfo,\r\n\t\t\tcommonList,\r\n\t\t\tnoThing,\r\n\t\t\tloadMore\r\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tinfo:{\r\n\t\t\t\t\tcover: \"/static/common/banner2.jpg\",\r\n\t\t\t\t\ttitle: \"话题名称\",\r\n\t\t\t\t\tdesc: \"话题描述\",\r\n\t\t\t\t\ttoday_count: 0,\r\n\t\t\t\t\tnews_count: 10\r\n\t\t\t\t},\r\n\t\t\t\thotpost:[{\r\n\t\t\t\t\ttitle:\"【新人必读】 uni-app实战第二季商城类项目开发\"\r\n\t\t\t\t},{\r\n\t\t\t\t\ttitle:\"【新人必读】 uni-app实战第三季仿微信类项目开发\"\r\n\t\t\t\t}],\r\n\t\t\t\ttabIndex:0,\r\n\t\t\t\ttabBars:[{\r\n\t\t\t\t\tname:\"热门\"\r\n\t\t\t\t},{\r\n\t\t\t\t\tname:\"最新\"\r\n\t\t\t\t}],\r\n\t\t\t\t// 热门\r\n\t\t\t\tlist1:[],\r\n\t\t\t\tloadtext1:\"上拉加载更多\",\r\n\t\t\t\tpage1:1,\r\n\t\t\t\tfirstLoad1:false,\r\n\t\t\t\t// 最新\r\n\t\t\t\tlist2:[],\r\n\t\t\t\tloadtext2:\"上拉加载更多\",\r\n\t\t\t\tpage2:1,\r\n\t\t\t\tfirstLoad2:false,\n\t\t\t}\n\t\t},\r\n\t\tcomputed:{\r\n\t\t\t// 当前列表数据\r\n\t\t\tlistData() {\r\n\t\t\t\t// return this['list'+this.tabIndex+1]\r\n\t\t\t\tif(this.tabIndex === 0) {\r\n\t\t\t\t\treturn this.list1\r\n\t\t\t\t}\r\n\t\t\t\treturn this.list2\r\n\t\t\t},\r\n\t\t\t// 当前上拉加载\r\n\t\t\tloadtext() {\r\n\t\t\t\tif(this.tabIndex === 0) {\r\n\t\t\t\t\treturn this.loadtext1\r\n\t\t\t\t}\r\n\t\t\t\treturn this.loadtext2\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\tif (e.detail) {\r\n\t\t\t\tthis.info = JSON.parse(e.detail)\r\n\t\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\t\ttitle:this.info.title\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t// 加载数据\r\n\t\t\tthis.getData()\r\n\t\t\t// 监听关注和顶踩操作\r\n\t\t\tuni.$on('updateFollowOrLiked',(e)=>{\r\n\t\t\t\tswitch (e.type){\r\n\t\t\t\t\tcase 'follow'://关注\r\n\t\t\t\t\tthis.follow(e.data.user_id)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'liked':\r\n\t\t\t\t\tthis.liked(e.data)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t// 触底事件\r\n\t\tonReachBottom() {\r\n\t\t\tthis.loadmore()\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tuni.$off('updateFollowOrLiked',(e)=>{})\r\n\t\t},\n\t\tmethods: {\r\n\t\t\t//关注\r\n\t\t\tfollow(user_id){\r\n\t\t\t\t// 找到当前作者的所有列表\r\n\t\t\t\tthis.list1.forEach((item)=>{\r\n\t\t\t\t\tif(item.user_id === user_id){\r\n\t\t\t\t\t\titem.isFollow = true\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tthis.list2.forEach((item)=>{\r\n\t\t\t\t\tif(item.user_id === user_id){\r\n\t\t\t\t\t\titem.isFollow = true\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle:'关注成功',\r\n\t\t\t\t\ticon:'none'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//顶踩\r\n\t\t\tliked(e){\r\n\t\t\t\t// 拿到当前的选项卡对应的list\r\n\t\t\t\tlet no = this.tabIndex + 1\r\n\t\t\t\tthis['list'+no].forEach(item=>{\r\n\t\t\t\t\tif(item.id === e.id){\r\n\t\t\t\t\t\tif (item.liked.type === ''){\r\n\t\t\t\t\t\t\titem.liked[e.type+'_count']++\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (item.liked.type === 'liked' && e.type === 'disliked'){\r\n\t\t\t\t\t\t\titem.liked.liked_count--;\r\n\t\t\t\t\t\t\titem.liked.disliked_count++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(item.liked.type === 'disliked' && e.type === 'liked'){\r\n\t\t\t\t\t\t\titem.liked.liked_count++;\r\n\t\t\t\t\t\t\titem.liked.disliked_count--;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titem.liked.type = e.type\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tlet msg = e.type === 'liked' ? '赞':'踩'\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle:msg+'成功',\r\n\t\t\t\t\ticon:'none'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// tab切换\n\t\t\tchangeTab(index){\r\n\t\t\t\tthis.tabIndex = index\r\n\t\t\t\tif(!this['firstLoad'+(index+1)]) {\r\n\t\t\t\t\tthis.getData()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 加载数据\r\n\t\t\tgetData() {\r\n\t\t\t\tlet no = this.tabIndex + 1\r\n\t\t\t\tlet page = this['page'+no]\r\n\t\t\t\tlet isrefresh = page === 1\r\n\t\t\t\tthis.$H.get('/topic/'+this.info.id+\"/post/\"+page).then(res=>{\r\n\t\t\t\t\tlet list = res.data.data.list.map(v=>{\r\n\t\t\t\t\t\treturn this.$U.formatCommonList(v)\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis['list'+no] = isrefresh ? list : [...this['list'+no],...list],\r\n\t\t\t\t\tthis['loadtext'+no] = list.length < 10 ?'没有更多了' : '上拉加载更多'\r\n\t\t\t\t\tif (isrefresh) {\r\n\t\t\t\t\t\tthis['firstLoad'+no] = true\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(err=>{\r\n\t\t\t\t\tif (!isrefresh) {\r\n\t\t\t\t\t\tpage--\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 上拉加载更多\r\n\t\t\tloadmore() {\r\n\t\t\t\t// 拿到当前列表\r\n\t\t\t\tlet index = this.tabIndex\r\n\t\t\t\t// 判断是否处于可加载状态\r\n\t\t\t\tif (this.loadtext !== '上拉加载更多') return;\r\n\t\t\t\t// 设置上拉加载状态处于加载中\r\n\t\t\t\tthis['loadtext'+(index+1)] = '加载中...'\r\n\t\t\t\t// 请求数据\r\n\t\t\t\tthis['page'+(index+1)]++;\r\n\t\t\t\tthis.getData()\r\n\t\t\t}\t\t\t\n\t\t}\n\t}\n</script>\n\n<style>\n\t.filter{\r\n\t\tfilter: blur(8px);\r\n\t}\n</style>\n","import MiniProgramPage from 'F:/project/社区交友/pages/topic-detail/topic-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","e"],"mappings":"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"}