{"version":3,"file":"post-detail.js","sources":["pages/post-detail/post-detail.vue","../../AppGallery/HBuilderX.4.75.2025070414-alpha/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcG9zdC1kZXRhaWwvcG9zdC1kZXRhaWwudnVl"],"sourcesContent":["<template>\n\t<view>\n\t\t<!-- 帖子详情页详细信息 -->\r\n\t\t<common-list :item=\"info\" isdetail @doComment=\"doComment\" @shared=\"shared\"\r\n\t\t@follow=\"follow\" @liked=\"liked\">\r\n\t\t\t<view>{{info.content}}</view>\r\n\t\t\t<view>\r\n\t\t\t\t<image v-for=\"(item,index) in images\" :src=\"item.url\" \r\n\t\t\t\tclass=\"w-100\" mode=\"widthFix\" @click=\"preview(index)\"></image>\r\n\t\t\t</view>\r\n\t\t</common-list>\r\n\t\t\r\n\t\t<view class=\"divider\"></view>\r\n\t\t<view class=\"p-2 font-md font-weight-bold\">\r\n\t\t\t最新评论 {{comments.length}}\r\n\t\t</view>\r\n\t\t<view class=\"px-2\">\r\n\t\t\t<view class=\"uni-comment-list\" v-for=\"(item,index) in comments\" :key=\"index\">\r\n\t\t\t\t<view v-if=\"item.fid\" style=\"width: 60rpx;\"></view>\r\n\t\t\t\t<view class=\"flex w-100\" :class=\"item.fid ? 'bg-light rounded p-2' : ''\">\r\n\t\t\t\t\t<view class=\"uni-comment-face\"><image :src=\"item.userpic\"\r\n\t\t\t\t\tmode=\"widthFix\"></image></view>\r\n\t\t\t\t\t<view class=\"uni-comment-body\">\r\n\t\t\t\t\t\t<view class=\"uni-comment-top\">\r\n\t\t\t\t\t\t\t<text>{{item.username}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"uni-comment-content\" @click=\"reply(item.id)\">{{item.data}}</view>\r\n\t\t\t\t\t\t<view class=\"uni-comment-date\">\r\n\t\t\t\t\t\t\t<view>{{item.time}}</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 弹出分享 -->\r\n\t\t<share-to ref=\"share\"></share-to>\r\n\t\t<!-- 占位 -->\r\n\t\t<view style=\"height: 100rpx;\"></view>\r\n\t\t<!-- 底部发送框 -->\r\n\t\t<bottom-input :focus=\"focus\" @blur=\"blur\" @submit=\"submit\"></bottom-input>\n\t</view>\n</template>\n\n<script>\r\n\timport commonList from '@/components/common/common-list.vue';\r\n\timport bottomInput from '@/components/common/bottom-input.vue';\r\n\timport shareTo from '@/components/common/share-to.vue';\n\texport default {\r\n\t\tcomponents:{\r\n\t\t\tcommonList,\r\n\t\t\tbottomInput,\r\n\t\t\tshareTo\r\n\t\t},\n\t\tdata() {\n\t\t\treturn {\t\t\t\t\n\t\t\t\t// 当前帖子信息\r\n\t\t\t\tinfo:{\r\n\t\t\t\t\tid:0,\r\n\t\t\t\t\tuser_id:0,\r\n\t\t\t\t\tusername:\"昵称\",\r\n\t\t\t\t\tuserpic:\"/static/common/demo5.jpg\",\r\n\t\t\t\t\tnowstime:\"2019-10-20 下午04:30\",\r\n\t\t\t\t\tisFollow:false,\r\n\t\t\t\t\ttitle:\"我是标题\",\r\n\t\t\t\t\ttitlepic:\"/static/common/demo2.jpg\",\r\n\t\t\t\t\tliked:{\r\n\t\t\t\t\t\ttype:\"liked\",\r\n\t\t\t\t\t\tliked_count:1,\r\n\t\t\t\t\t\tdisliked_count:2\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomment_count:2,\r\n\t\t\t\t\tshare_count:2,\r\n\t\t\t\t\tcontent:\"地煞编程学院:多热烈的白羊,热烈得好抽象,抽象掩盖欲望,却又欲盖弥彰\",\r\n\t\t\t\t},\r\n\t\t\t\timages:[],\r\n\t\t\t\tcomments:[],\r\n\t\t\t\tfocus:false,\r\n\t\t\t\treply_id:0,\r\n\t\t\t\ttemp_reply_id: 0 // 新增临时存储\n\t\t\t}\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\t// 初始化操作\r\n\t\t\tif (e.detail) {\r\n\t\t\t\tthis.__init(JSON.parse(e.detail))\r\n\t\t\t}\r\n\t\t\t// 监听关注和顶踩操作\r\n\t\t\tuni.$on('updateFollowOrLiked',(e)=>{\r\n\t\t\t\tswitch (e.type){\r\n\t\t\t\t\tcase 'follow'://关注\r\n\t\t\t\t\tthis.follow(e.data.user_id)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'liked':\r\n\t\t\t\t\tthis.liked(e.data)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tuni.$off('updateFollowOrLiked',(e)=>{})\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\timagesList() {\r\n\t\t\t\treturn this.images.map(item=>item.url) \r\n\t\t\t}\r\n\t\t},\r\n\t\tonNavigationBarButtonTap() {\r\n\t\t\tthis.$refs.share.open({\r\n\t\t\t\ttitle: this.info.title,\r\n\t\t\t\tshareText: this.info.title,\r\n\t\t\t\thref:\"https://www.dishaxy.com\",\r\n\t\t\t\timage: this.info.titlepic,\r\n\t\t\t})\r\n\t\t},\r\n\t\tonBackPress() {\r\n\t\t\tthis.$refs.share.close()\r\n\t\t},\r\n\t\t// #ifndef APP-PLUS\r\n\t\t// 微信小程序分享\r\n\t\tonShareAppMessage(res) {\r\n\t\t\treturn {\r\n\t\t\t  title: this.info.title,\r\n\t\t\t  path: '/pages/post-detail/post-detail?detail='+JSON.stringify(this.info)\r\n\t\t\t}\r\n\t\t },\r\n\t\t// #endif\n\t\tmethods: {\n\t\t\t__init(data) {\r\n\t\t\t\t// 修改标题\r\n\t\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\t\ttitle:data.title\r\n\t\t\t\t})\r\n\t\t\t\tthis.info = data\r\n\t\t\t\tthis.info.content = ''\r\n\t\t\t\t//请求api\r\n\t\t\t\tthis.$H.get('/post/'+this.info.id).then(res=>{\r\n\t\t\t\t\tthis.info.content = res.data.data.detail.content\r\n\t\t\t\t\tthis.images = res.data.data.detail.images\r\n\t\t\t\t})\r\n\t\t\t\tthis.getComment()\r\n\t\t\t},\r\n\t\t\t// 点击评论\r\n\t\t\tdoComment() {\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\t// 点击分享\r\n\t\t\tshared() {\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\t// 关注\r\n\t\t\tfollow() {\r\n\t\t\t\tthis.info.isFollow = true\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle:'关注成功'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 顶踩操作\r\n\t\t\tliked(e) {\r\n\t\t\t\tif(this.info.liked.type === e.type) {\r\n\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\ttitle:'你已经操作过了',\r\n\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t})\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tlet msg = e.type === 'liked' ? '顶' : '踩'\r\n\t\t\t\t// 判断之前有没有操作过\r\n\t\t\t\tif (this.info.liked === '') {\r\n\t\t\t\t\tthis.info.liked[e.type+'_count']++\r\n\t\t\t\t}else if(this.info.liked.type === 'liked' && e.type === 'disliked') {\r\n\t\t\t\t\tthis.info.liked.liked_count--;\r\n\t\t\t\t\tthis.info.liked.disliked_count++;\r\n\t\t\t\t}else if(this.info.liked.type === 'disliked' && e.type === 'liked') {\r\n\t\t\t\t\tthis.info.liked.liked_count++;\r\n\t\t\t\t\tthis.info.liked.disliked_count--;\r\n\t\t\t\t}\r\n\t\t\t\tthis.info.liked.type = e.type\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: msg\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 预览图片\r\n\t\t\tpreview(index) {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent:index,\r\n\t\t\t\t\turls:this.imagesList,\r\n\t\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 提交评论\r\n\t\t\tsubmit(data) {\r\n\t\t\t\tif(data === '') {\r\n\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\ttitle: '评论不能为空',\r\n\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle:'评论中...',\r\n\t\t\t\t\tmask:false\r\n\t\t\t\t})\r\n\t\t\t\tthis.$H.post('/post/comment',{\r\n\t\t\t\t\tfid:this.temp_reply_id,\r\n\t\t\t\t\tdata:data,\r\n\t\t\t\t\tpost_id:this.info.id\r\n\t\t\t\t},{\r\n\t\t\t\t\ttoken:true\r\n\t\t\t\t}).then(res=>{\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\tthis.temp_reply_id = 0\r\n\t\t\t\t\tthis.getComment()\r\n\t\t\t\t}).catch(err=>{\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\tthis.temp_reply_id = 0\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 获取评论\r\n\t\t\tgetComment(){\r\n\t\t\t\tthis.$H.get('/post/'+this.info.id+'/comment').then(res=>{\r\n\t\t\t\t\tthis.comments = this.__ArrSort(res.data.data.list)\r\n\t\t\t\t\tthis.info.comment_count = this.comments.length\r\n\t\t\t\t\tuni.$emit('updateCommentsCount',{\r\n\t\t\t\t\t\tid:this.info.id,\r\n\t\t\t\t\t\tcount:this.info.comment_count\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 重新整理评论格式\r\n\t\t\t__ArrSort(arr,id = 0){\r\n\t\t\t\tvar temp = [],lev=0;\r\n\t\t\t\tvar forFn = function(arr, id,lev){\r\n\t\t\t\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\t\t\t\tvar item = arr[i];\r\n\t\t\t\t\t\tif (item.fid==id) {\r\n\t\t\t\t\t\t\titem.lev=lev;\r\n\t\t\t\t\t\t\ttemp.push({\r\n\t\t\t\t\t\t\t\tid:item.id,\r\n\t\t\t\t\t\t\t\tfid:item.fid,\r\n\t\t\t\t\t\t\t\tuserid:item.user.id,\r\n\t\t\t\t\t\t\t\tuserpic:item.user.userpic,\r\n\t\t\t\t\t\t\t\tusername:item.user.username,\r\n\t\t\t\t\t\t\t\ttime:item.create_time,\r\n\t\t\t\t\t\t\t\t// time:$T.gettime(item.create_time),\r\n\t\t\t\t\t\t\t\tdata:item.data,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tforFn(arr,item.id,lev+1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tforFn(arr, id,lev);\r\n\t\t\t\treturn temp;\r\n\t\t\t},\r\n\t\t\t// 回复评论\r\n\t\t\treply(id) {\r\n\t\t\t\tthis.temp_reply_id = id // 存储到临时变量\r\n\t\t\t\tthis.reply_id = id\r\n\t\t\t\tthis.focus = true\r\n\t\t\t},\r\n\t\t\t// 输入框失去焦点\r\n\t\t\tblur(){\r\n\t\t\t\tthis.reply_id = 0\r\n\t\t\t\tthis.focus = false\r\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\n</style>\n","import MiniProgramPage from 'F:/project/社区交友/pages/post-detail/post-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","e","arr","id"],"mappings":"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"}