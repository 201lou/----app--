{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../AppGallery/HBuilderX.4.75.2025070414-alpha/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n\t<view>\r\n\t\t<!-- 导航栏 -->\r\n\t\t<!-- #ifdef MP -->\r\n\t\t<uni-nav-bar :shadow=\"false\" :border=\"false\"@click-left=\"clickLeft\" \r\n\t\t@click-right=\"clickRight\">\r\n\t\t\t<!-- 左边图标 -->\r\n\t\t\t<block slot=\"left\">\r\n\t\t\t\t<view class=\"iconfont icon-qiandao ml-2 mr-2\" \r\n\t\t\t\tstyle=\"font-size: 22px;color: #FF9619;\"></view>\r\n\t\t\t</block>\r\n\t\t\t<!-- 中间搜索框 -->\r\n\t\t\t<view class=\"flex justify-center align-center rounded text-muted bg-light flex-1 mt-1\" \r\n\t\t\tstyle=\"margin-left: -46upx;height: 60upx;\" @tap=\"openSearch\">\r\n\t\t\t\t<view class=\"iconfont icon-sousuo mr-1\"></view>搜索帖子\r\n\t\t\t</view>\r\n\t\t\t<!-- 右边图标 -->\r\n\t\t\t<block slot=\"right\">\r\n\t\t\t\t<view class=\"icon iconfont icon-bianji1 text-dark\" \r\n\t\t\t\tstyle=\"font-size: 22px;\"></view>\r\n\t\t\t</block>\r\n\t\t</uni-nav-bar>\r\n\t\t<!-- #endif -->\r\n\t\t<!-- 顶部选项卡 -->\r\n\t\t<scroll-view scroll-x :scroll-into-view=\"scrollInto\" \r\n\t\tscroll-with-animation class=\"scroll-row\" style=\"height: 100rpx;\">\r\n\t\t\t<view v-for=\"(item,index) in tabBars\" :key=\"index\" \r\n\t\t\tclass=\"scroll-row-item px-3 py-2\" :id=\"'tab'+index\"\r\n\t\t\t:class=\"tabIndex === index?'color-global font-lg font-weight-bold':''\"\r\n\t\t\t@click=\"changeTab(index)\">{{item.classname}}</view>\r\n\t\t</scroll-view>\r\n\t\t\r\n\t\t<!-- 滑动列表 -->\r\n\t\t<swiper :duration=\"150\" :current=\"tabIndex\" @change=\"onChangeTab\" :style=\"'height:'+scrollH+'px;'\">\r\n\t\t\t<swiper-item v-for=\"(item,index) in newList\" :key=\"index\">\r\n\t\t\t\t<scroll-view scroll-y=\"true\" :style=\"'height:'+scrollH+'px;'\" @scrolltolower=\"loadmore(index)\">\r\n\t\t\t\t\t<template v-if=\"item.list.length > 0\">\r\n\t\t\t\t\t<!-- 列表 -->\r\n\t\t\t\t\t<block v-for=\"(item2,index2) in item.list\" :key=\"index2\">\r\n\t\t\t\t\t\t<!-- 列表样式 -->\r\n\t\t\t\t\t\t<common-list :item=\"item2\" :index=\"index2\" @follow=\"follow\" @liked=\"liked\"></common-list>\r\n\t\t\t\t\t\t<!-- 全局分割线 -->\r\n\t\t\t\t\t\t<view class=\"divider\"></view>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t\t<!-- 上拉加载 -->\r\n\t\t\t\t\t<load-more :loadmore=\"item.loadmore\"></load-more>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t\t<!-- 加载中 -->\r\n\t\t\t\t\t<template v-else-if=\"!item.firstload\">\r\n\t\t\t\t\t\t<view class=\"text-light-muted flex align-center justify-center font-md\"\r\n\t\t\t\t\t\tstyle=\"height: 200rpx;\">加载中</view>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t\t<!-- 没有数据 -->\r\n\t\t\t\t\t<template v-else>\r\n\t\t\t\t\t\t<no-thing></no-thing>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</scroll-view>\r\n\t\t\t</swiper-item>\r\n\t\t</swiper>\r\n\t\t\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport uniNavBar from '@/components/uni-uni/uni-nav-bar/uni-nav-bar.vue';\r\n\timport commonList from '@/components/common/common-list.vue';\r\n\timport loadMore from '@/components/common/load-more.vue';\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tcommonList,\r\n\t\t\tloadMore,\r\n\t\t\tuniNavBar\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t//列表高度\r\n\t\t\t\tscrollH : 600,\r\n\t\t\t\t// 顶部选项卡\r\n\t\t\t\tscrollInto : \"\",\r\n\t\t\t\ttabIndex : 0,\r\n\t\t\t\ttabBars: [],\r\n\t\t\t\tnewList:[]\r\n\t\t\t}\r\n\t\t},\r\n\t\t//监听点击导航栏搜索框\r\n\t\tonNavigationBarSearchInputClicked() {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl:\"/pages/search/search?type=post\",\r\n\t\t\t})\r\n\t\t},\r\n\t\t//监听导航按钮点击事件\r\n\t\tonNavigationBarButtonTap() {\r\n\t\t\tthis.navigateTo({\r\n\t\t\t\turl:'/pages/add-input/add-input',\r\n\t\t\t})\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t// this.$store.commit('changeLoginStatus',{num:\"123\"})\r\n\t\t\t// console.log(this.$store.state.loginStatus);\t\t\t\r\n\t\t\tuni.getSystemInfo({\r\n\t\t\t\tsuccess:res=>{\r\n\t\t\t\t\tthis.scrollH = res.windowHeight - uni.upx2px(100)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// 监听首页刷新\r\n\t\t\tuni.$on('updateIndex',()=>{\r\n\t\t\t\tthis.getData()\r\n\t\t\t})\r\n\t\t\t// 根据选项生成列表\r\n\t\t\tthis.getData()\r\n\t\t\t// 监听关注和顶踩操作\r\n\t\t\tuni.$on('updateFollowOrLiked',(e)=>{\r\n\t\t\t\tswitch (e.type){\r\n\t\t\t\t\tcase 'follow'://关注\r\n\t\t\t\t\tthis.follow(e.data.user_id)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'liked':\r\n\t\t\t\t\tthis.liked(e.data)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// 监听评论数变化\r\n\t\t\tuni.$on('updateCommentsCount',({id,count})=>{\r\n\t\t\t\tthis.newList.forEach(tab=>{\r\n\t\t\t\t\ttab.list.forEach(item=>{\r\n\t\t\t\t\t\tif(item.id === id) {\r\n\t\t\t\t\t\t\titem.comment_count = count\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tuni.$off('updateFollowOrLiked',(e)=>{})\r\n\t\t\tuni.$off('updateIndex',(e)=>{})\r\n\t\t\tuni.$off('updateCommentsCount',(e)=>{})\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// #ifndef APP-PLUS\r\n\t\t\tclickLeft(){\r\n\t\t\t\t// console.log('左边事件')\r\n\t\t\t},\r\n\t\t\tclickRight(){\r\n\t\t\t\t// 打开发布页面\r\n\t\t\t\tthis.navigateTo({\r\n\t\t\t\t\turl: '../add-input/add-input',\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\topenSearch(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '../search/search',\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// #endif\r\n\t\t\t//获取数据\r\n\t\t\tgetData() {\r\n\t\t\t\t// 获取分类\r\n\t\t\t\tthis.$H.get('/postclass').then(res=>{\r\n\t\t\t\t\tthis.tabBars = res.data.data.list\r\n\t\t\t\t\t// 根据分类生成列表\r\n\t\t\t\t\tvar arr = []\r\n\t\t\t\t\tfor (let i = 0; i < this.tabBars.length; i++) {\r\n\t\t\t\t\t\t//生成列表模板\r\n\t\t\t\t\t\tarr.push({\r\n\t\t\t\t\t\t\t//1.上拉加载更多 2.加载中 3...没有更多了\r\n\t\t\t\t\t\t\tloadmore:\"上拉加载更多\",\r\n\t\t\t\t\t\t\tlist:[],\r\n\t\t\t\t\t\t\tpage:1,\r\n\t\t\t\t\t\t\tfirstLoad:false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.newList = arr\r\n\t\t\t\t\t// 获取第一个分类的数据\r\n\t\t\t\t\tif (this.tabBars.length) {\r\n\t\t\t\t\t\tthis.getList()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\t\t\t\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\t// 获取指定分类下的列表数据\r\n\t\t\tgetList(){\r\n\t\t\t\tlet index = this.tabIndex\r\n\t\t\t\tlet id = this.tabBars[index].id\r\n\t\t\t\tlet page = this.newList[index].page\r\n\t\t\t\tlet isrefresh = page === 1\r\n\t\t\t\tthis.$H.get('/postclass/'+id+'/post/'+page,{},{\r\n\t\t\t\t\ttoken:true,\r\n\t\t\t\t\tnoCheck:true\r\n\t\t\t\t}).then(res2=>{\r\n\t\t\t\t\tlet list = res2.data.data.list.map(v=>{\r\n\t\t\t\t\t\treturn this.$U.formatCommonList(v)\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.newList[index].list = isrefresh ? list : [...this.newList[index].list,\r\n\t\t\t\t\t...list],\r\n\t\t\t\t\tthis.newList[index].loadmore = list.length < 10 ?'没有更多了' : '上拉加载更多'\r\n\t\t\t\t\tif (isrefresh) {\r\n\t\t\t\t\t\tthis.newList[index].firstLoad = true\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(err=>{\r\n\t\t\t\t\tif (!isrefresh) {\r\n\t\t\t\t\t\tthis.newList[index].page--\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//监听滑动\r\n\t\t\tonChangeTab(e) {\r\n\t\t\t\tthis.changeTab(e.detail.current)\r\n\t\t\t},\r\n\t\t\t//切换选项卡\r\n\t\t\tchangeTab(index){\r\n\t\t\t\tif (this.tabIndex === index){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.tabIndex = index\r\n\t\t\t\t// 滚动到指定元素\r\n\t\t\t\tthis.scrollInto = 'tab'+index\r\n\t\t\t\t// 获取当前分类下的列表数据\r\n\t\t\t\tif (!this.newList[this.tabIndex].firstLoad) {\r\n\t\t\t\t\tthis.getList()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//关注\r\n\t\t\tfollow(user_id){\r\n\t\t\t\t// 找到当前作者的所有列表\r\n\t\t\t\tthis.newList.forEach(tab=>{\r\n\t\t\t\t\ttab.list.forEach((item)=>{\r\n\t\t\t\t\t\tif(item.user_id === user_id){\r\n\t\t\t\t\t\t\titem.isFollow = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle:'关注成功',\r\n\t\t\t\t\ticon:'none'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//顶踩\r\n\t\t\tliked(e){\r\n\t\t\t\tthis.newList[this.tabIndex].list.forEach(item=>{\r\n\t\t\t\t\tif(item.id === e.id){\r\n\t\t\t\t\t\tif (item.liked.type === ''){\r\n\t\t\t\t\t\t\titem.liked[e.type+'_count']++\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (item.liked.type === 'liked' && e.type === 'disliked'){\r\n\t\t\t\t\t\t\titem.liked.liked_count--;\r\n\t\t\t\t\t\t\titem.liked.disliked_count++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if(item.liked.type === 'disliked' && e.type === 'liked'){\r\n\t\t\t\t\t\t\titem.liked.liked_count++;\r\n\t\t\t\t\t\t\titem.liked.disliked_count--;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titem.liked.type = e.type\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tlet msg = e.type === 'liked' ? '赞':'踩'\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle:msg+'成功',\r\n\t\t\t\t\ticon:'none'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//上拉加载更多\r\n\t\t\tloadmore(index) {\r\n\t\t\t\t// 拿到当前列表\r\n\t\t\t\tlet item = this.newList[index]\r\n\t\t\t\t// 判断是否处于可加载状态\r\n\t\t\t\tif(item.loadmore !== '上拉加载更多') return;\r\n\t\t\t\t//修改当前列表加载状态\r\n\t\t\t\titem.loadmore = '加载中...'\r\n\t\t\t\t// 请求数据\r\n\t\t\t\titem.page++;\r\n\t\t\t\tthis.getList()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t\r\n</style>\n","import MiniProgramPage from 'F:/project/社区交友/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}