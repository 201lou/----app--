{"version":3,"file":"add-input.js","sources":["pages/add-input/add-input.vue","../../AppGallery/HBuilderX.4.75.2025070414-alpha/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRkLWlucHV0L2FkZC1pbnB1dC52dWU"],"sourcesContent":["<template>\n\t<view>\r\n\t\t<!-- 自定义导航 -->\r\n\t\t<!-- #ifdef MP -->\r\n\t\t<uni-nav-bar :border=\"false\">\r\n\t\t\t<view class=\"flex align-center justify-center w-100\"\r\n\t\t\t@click=\"changeOpen\">\r\n\t\t\t\t{{isOpenText}}<text class=\"iconfont icon-shezhi1\"></text>\r\n\t\t\t</view>\r\n\t\t</uni-nav-bar>\r\n\t\t<!-- #endif -->\r\n\t\t<!-- #ifndef MP -->\r\n\t\t<uni-nav-bar left-icon=\"back\" statusBar :border=\"false\" @click-left=\"goBack\">\r\n\t\t\t<view class=\"flex align-center justify-center w-100\"\r\n\t\t\t@click=\"changeOpen\">\r\n\t\t\t\t{{isOpenText}}<text class=\"iconfont icon-shezhi1\"></text>\r\n\t\t\t</view>\r\n\t\t</uni-nav-bar>\r\n\t\t<!-- #endif -->\r\n\t\t<!-- 自定义导航 -->\n\t\t<!-- <uni-nav-bar left-icon=\"back\" statusBar :border=\"false\" @click-left=\"back\">\r\n\t\t\t<view class=\"flex align-center justify-center w-100\" @click=\"changeOpen\">\r\n\t\t\t{{isOpenText}}<text class=\"iconfont icon-shezhi1\"></text>\r\n\t\t\t</view>\r\n\t\t</uni-nav-bar> -->\r\n\t\t<!-- 文本域组件 -->\r\n\t\t<textarea v-model=\"content\" placeholder=\"说一句话吧~\" class=\"w-100 px-2\"/>\r\n\t\t<!-- 选中的分类 -->\r\n\t\t<view class=\"font-md px-2 py-1 flex\">\r\n\t\t\t<view class=\"border px-3 py text-dark flex align-center justify-center\"\r\n\t\t\tstyle=\"border-radius: 50rpx;\">\r\n\t\t\t\t<text class=\"iconfont icon-huatifuhao mr-1\"></text>\r\n\t\t\t\t{{post_class_name ? \"所属分类：\"+post_class_name : \"请选择分类\"}}\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 选中的话题 -->\r\n\t\t<view class=\"font-md px-2 py-1 flex\">\r\n\t\t\t<view class=\"border px-3 py text-dark flex align-center justify-center\"\r\n\t\t\tstyle=\"border-radius: 50rpx;\">\r\n\t\t\t\t<text class=\"iconfont icon-huatifuhao mr-1\"></text>\r\n\t\t\t\t{{topic.title ? \"所属话题：\"+topic.title : \"请选择话题\"}}\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 上传多图 -->\r\n\t\t<upload-image :show=\"show\" ref=\"uploadImage\" :list=\"imageList\" @change=\"changeImage\"></upload-image>\r\n\t\t<!-- 底部操作条 -->\r\n\t\t<view class=\"fixed-bottom bg-white flex align-center justify-center\" style=\"height: 85rpx;\">\r\n\t\t\t<picker mode=\"selector\" :range=\"range\" @change=\"choosePostClass\">\r\n\t\t\t\t<view class=\"footer-btn iconfont icon-caidan animated faster\"\r\n\t\t\t\thover-calss=\"jello\"></view>\r\n\t\t\t</picker>\r\n\t\t\t<view class=\"footer-btn iconfont icon-huatifuhao animated faster\" hover-calss=\"jello\"\r\n\t\t\t@click=\"chooseTopic\"></view>\r\n\t\t\t<view class=\"footer-btn iconfont icon-tupian animated faster\" \r\n\t\t\thover-calss=\"jello\" @click=\"iconclick('uploadImage')\"></view>\r\n\t\t\t\r\n\t\t\t<view class=\"bg-color text-white ml-auto flex justify-center align-center rounded mr-3 animated faster\" \r\n\t\t\tstyle=\"width: 140rpx;height: 60rpx;\" hover-class=\"bounce\" @click=\"submit\">发送</view>\r\n\t\t</view>\n\t</view>\n</template>\n\n<script>\r\n\tconst isOpenArray = ['仅自己可见','所有人可见'];\r\n\timport uniNavBar from '@/components/uni-uni/uni-nav-bar/uni-nav-bar.vue';\r\n\timport uploadImage from '@/components/common/upload-image.vue';\n\texport default {\r\n\t\tcomponents:{\r\n\t\t\tuniNavBar,\r\n\t\t\tuploadImage\r\n\t\t},\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tcontent:\"\",\r\n\t\t\t\timageList:[],\r\n\t\t\t\tshowBack:false,\r\n\t\t\t\tisOpen:1,\r\n\t\t\t\ttopic:{\r\n\t\t\t\t\tid:0,\r\n\t\t\t\t\ttitle:\"\"\r\n\t\t\t\t},\r\n\t\t\t\tpost_class_list:[],\r\n\t\t\t\tpost_class_index:-1\n\t\t\t}\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tshow() {\r\n\t\t\t\treturn this.imageList.length > 0 \r\n\t\t\t},\r\n\t\t\tisOpenText(){\r\n\t\t\t\treturn isOpenArray[this.isOpen]\r\n\t\t\t},\r\n\t\t\t// 文章分类可选项\r\n\t\t\trange(){\r\n\t\t\t\treturn this.post_class_list.map(item=>{\r\n\t\t\t\t\treturn item.classname\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tpost_class_id(){\r\n\t\t\t\tif(this.post_class_index !== -1){\r\n\t\t\t\t\treturn this.post_class_list[this.post_class_index].id\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpost_class_name(){\r\n\t\t\t\tif(this.post_class_index !== -1){\r\n\t\t\t\t\treturn this.post_class_list[this.post_class_index].classname\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\timageListIds(){\r\n\t\t\t\treturn this.imageList.map(item=>{\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tid:item.id\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 监听返回\r\n\t\tonBackPress() {\r\n\t\t\t\tif ( (this.content !== '' || this.imageList.length > 0) && !this.showBack) {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent:'是否要保存为草稿?',\r\n\t\t\t\t\t\tshowCancel:true,\r\n\t\t\t\t\t\tcancelText:'不保存',\r\n\t\t\t\t\t\tconfirmText:'保存',\r\n\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\t//点击保存\r\n\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\tthis.store()\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\tuni.removeStorage({\r\n\t\t\t\t\t\t\t\t\tkey:\"add-input\"\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//手动执行返回\r\n\t\t\t\t\t\t\tuni.navigateBack({ delta : 1});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.showBack = true\r\n\t\t\t\treturn true\r\n\t\t\t\t}\r\n\t\t},\r\n\t\t//页面加载\r\n\t\tonLoad() {\r\n\t\t\tuni.getStorage({\r\n\t\t\t\tkey:\"add-input\",\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (res.data) {\r\n\t\t\t\t\t\tlet result = JSON.parse(res.data)\r\n\t\t\t\t\t\tthis.content = result.content,\r\n\t\t\t\t\t\tthis.imageList = result.imageList\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// 监听选择话题事件\r\n\t\t\tuni.$on('chooseTopic',(e)=>{\r\n\t\t\t\tthis.topic.id = e.id\r\n\t\t\t\tthis.topic.title = e.title\r\n\t\t\t})\r\n\t\t\t// 获取所有文章分类\r\n\t\t\tthis.getPostClass()\r\n\t\t},\r\n\t\tbeforeDestroy() {\r\n\t\t\tuni.$off('chooseTopic',(e)=>{})\r\n\t\t},\n\t\tmethods: {\r\n\t\t\t// 发布文章\r\n\t\t\tsubmit(){\r\n\t\t\t\tif(this.topic.id == 0) {\r\n\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\ttitle: '请选择话题',\r\n\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif(this.post_class_id == -1) {\r\n\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\ttitle: '请选择分类',\r\n\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle:'发布中。。。',\r\n\t\t\t\t\tmask:false\r\n\t\t\t\t})\r\n\t\t\t\tthis.$H.post('/post/create',{\r\n\t\t\t\t\timaglist:JSON.stringify(this.imageListIds),\r\n\t\t\t\t\ttext:this.content,\r\n\t\t\t\t\tisopen:this.isOpen,\r\n\t\t\t\t\ttopic_id:this.topic.id,\r\n\t\t\t\t\tpost_class_id:this.post_class_id\r\n\t\t\t\t},{\r\n\t\t\t\t\ttoken:true\r\n\t\t\t\t}).then(res=>{\r\n\t\t\t\t\tconsole.log(res) ;\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\tuni.$emit('updateIndex')\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle:'发布成功',\r\n\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.showBack = true\r\n\t\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\t\tdelta:1\r\n\t\t\t\t\t})\r\n\t\t\t\t}).catch(err=>{\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 获取所有文章分类\r\n\t\t\tgetPostClass(){\r\n\t\t\t\tthis.$H.get('/postclass').then(res=>{\r\n\t\t\t\t\tthis.post_class_list = res.data.data.list\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 选择文章分类\r\n\t\t\tchoosePostClass(e){\r\n\t\t\t\tthis.post_class_index = e.detail.value\r\n\t\t\t},\r\n\t\t\t// 选择话题\r\n\t\t\tchooseTopic(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '../topic-nav/topic-nav?choose=true'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 切换可见性\r\n\t\t\tchangeOpen(){\r\n\t\t\t\tuni.showActionSheet({\r\n\t\t\t\t\titemList:isOpenArray,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tthis.isOpen = res.tapIndex\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 返回上一步\r\n\t\t\tgoBack(){\r\n\t\t\t\tuni.navigateBack({ delta: 1 });\r\n\t\t\t},\r\n\t\t\t// 选中图片\n\t\t\tchangeImage(e){\r\n\t\t\t\tthis.imageList = e\r\n\t\t\t},\r\n\t\t\t//保存操作\r\n\t\t\tstore() {\r\n\t\t\t\t// 保存为本地存储\r\n\t\t\t\tuni.setStorage({\r\n\t\t\t\t\tkey:'add-input',\r\n\t\t\t\t\tdata:JSON.stringify({\r\n\t\t\t\t\t\tcontent:this.content,\r\n\t\t\t\t\t\timageList:this.imageList\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 返回上一步\r\n\t\t\tback() {\r\n\t\t\t\tuni.navigateBack();\r\n\t\t\t},\r\n\t\t\t// 底部图片图标点击\r\n\t\t\ticonclick(e) {\r\n\t\t\t\tswitch (e) {\r\n\t\t\t\t\tcase 'uploadImage':\r\n\t\t\t\t\tthis.$refs.uploadImage.chooseImage()\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\n\t\t}\r\n\t\t\n\t}\n</script>\n\n<style>\n\t.footer-btn {\r\n\t\twidth: 86rpx;\r\n\t\theight: 86rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tfont-size: 50rpx;\r\n\t}\n</style>\n","import MiniProgramPage from 'F:/project/社区交友/pages/add-input/add-input.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}