{"version":3,"file":"utill.js","sources":["common/utill.js"],"sourcesContent":["import $http from \"./request.js\";\r\nexport default {\r\n\t// 监听网络\r\n\tonNetwork() {\r\n\t\tlet func = (res)=>{\r\n\t\t\t\tif(res.networkType === 'none') {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle:'当前处于断网状态',\t\t\t\t\t\t\t\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\tuni.getNetworkType({\r\n\t\t\tsuccess:func\r\n\t\t});\r\n\t\tuni.onNetworkStatusChange(func);\r\n\t},\r\n\t// 热更新\r\n\tupdate(showToast = false){\r\n\t\t// #ifdef APP-PLUS\r\n\t\tplus.runtime.getProperty(plus.runtime.appid, function(widgetInfo) { \r\n\t\t\t$H.post('/update',{\r\n\t\t\t\tver:widgetInfo.version, \r\n\t\t\t}).then((data) => {\r\n\t\t\t\t// 成功\r\n\t\t\t\tif (!data.url){\r\n\t\t\t\t\t// 无需更新\r\n\t\t\t\t\tif(showToast){\r\n\t\t\t\t\t\tuni.showToast({ title: '无需更新',icon:\"none\" })\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn \r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '发现新的版本',\r\n\t\t\t\t\tcontent: '最新版本：'+data.version,\r\n\t\t\t\t\tcancelText: '放弃更新',\r\n\t\t\t\t\tconfirmText: '立即更新',\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif(!res.confirm) return;\r\n\t\t\t\t\t\tuni.downloadFile({\r\n\t\t\t\t\t\t\turl: data.url,  \r\n\t\t\t\t\t\t\tsuccess: (downloadResult) => {  \r\n\t\t\t\t\t\t\t\tif (downloadResult.statusCode === 200) {  \r\n\t\t\t\t\t\t\t\t\tplus.runtime.install(downloadResult.tempFilePath, {  \r\n\t\t\t\t\t\t\t\t\t\tforce: false  \r\n\t\t\t\t\t\t\t\t\t}, function() {  \r\n\t\t\t\t\t\t\t\t\t\tconsole.log('install success...');  \r\n\t\t\t\t\t\t\t\t\t\tplus.runtime.restart();  \r\n\t\t\t\t\t\t\t\t\t}, function(e) {  \r\n\t\t\t\t\t\t\t\t\t\tconsole.error('install fail...');  \r\n\t\t\t\t\t\t\t\t\t});  \r\n\t\t\t\t\t\t\t\t}  \r\n\t\t\t\t\t\t\t}  \r\n\t\t\t\t\t\t});  \r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t\t\r\n\t\t});  \r\n\t\t// #endif  \r\n\t},\r\n\t// 转换公共列表数据\r\n\tformatCommonList(v){\r\n\t\tlet isFollow = (v.user.fens.length > 0)\r\n\t\tlet liked = ''\r\n\t\tif(v.liked.length > 0){\r\n\t\t\tliked = v.liked[0].type === 0 ? 'liked' : 'disliked'\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tid:v.id,\r\n\t\t\tuser_id:v.user_id,\r\n\t\t\tusername:v.user.username,\r\n\t\t\tuserpic:v.user.userpic,\r\n\t\t\tnowstime:v.create_time,\r\n\t\t\tisFollow:isFollow,\r\n\t\t\ttitle:v.title,\r\n\t\t\ttitlepic:v.titlepic,\r\n\t\t\tliked:{\r\n\t\t\t\ttype:liked,\r\n\t\t\t\tliked_count:v.ding_count,\r\n\t\t\t\tdisliked_count:v.cai_count\r\n\t\t\t},\r\n\t\t\tcomment_count:v.comment_count,\r\n\t\t\tshare_count:v.share_count\r\n\t\t}\r\n\t},\r\n\t// 数组置顶\r\n\t__toFirst(arr,index){\r\n\t\tif (index != 0) {\r\n\t\t\tarr.unshift(arr.splice(index,1)[0]);\r\n\t\t}\r\n\t\treturn arr;\r\n\t},\r\n\t// userinfo格式转换\r\n\tformatUserinfo(obj){\r\n\t\t\t// 第三方登录（已绑定）\r\n\t\t\tif (obj.user && obj.user_id > 0) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: obj.user.id,\r\n\t\t\t\t\tusername: obj.user.username || obj.nickname,\r\n\t\t\t\t\tuserpic: obj.user.userpic || obj.avatarurl,\r\n\t\t\t\t\tphone: obj.user.phone,\r\n\t\t\t\t\temail: obj.user.email,\r\n\t\t\t\t\tstatus: obj.user.status,\r\n\t\t\t\t\tcreate_time: obj.user.create_time,\r\n\t\t\t\t\tlogintype: obj.logintype,\r\n\t\t\t\t\tpassword:obj.user.password,\r\n\t\t\t\t\ttoken: obj.token,\r\n\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\tid: obj.user.userinfo.id,\r\n\t\t\t\t\t\tuser_id: obj.user.userinfo.user_id,\r\n\t\t\t\t\t\tage: obj.user.userinfo.age,\r\n\t\t\t\t\t\tsex: obj.user.userinfo.sex,\r\n\t\t\t\t\t\tqg: obj.user.userinfo.qg,\r\n\t\t\t\t\t\tjob: obj.user.userinfo.job,\r\n\t\t\t\t\t\tpath: obj.user.userinfo.path,\r\n\t\t\t\t\t\tbirthday: obj.user.userinfo.birthday,\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 第三方登录（未绑定）\r\n\t\t\treturn {\r\n\t\t\t\tid: obj.user_id,\r\n\t\t\t\tusername: obj.nickname,\r\n\t\t\t\tuserpic: obj.avatarurl,\r\n\t\t\t\tphone: false,\r\n\t\t\t\temail: false,\r\n\t\t\t\tstatus: 1,\r\n\t\t\t\tcreate_time: false,\r\n\t\t\t\tlogintype: obj.logintype,\r\n\t\t\t\ttoken: obj.token,\r\n\t\t\t\tuserinfo: false\r\n\t\t\t}\r\n\t\t},\r\n}"],"names":["uni"],"mappings":";;;AACA,MAAe,KAAA;AAAA;AAAA,EAEd,YAAY;AACX,QAAI,OAAO,CAAC,QAAM;AAChB,UAAG,IAAI,gBAAgB,QAAQ;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAM;AAAA,QACZ,CAAM;AAAA,MACN;AAAA,IACI;AACFA,kBAAAA,MAAI,eAAe;AAAA,MAClB,SAAQ;AAAA,IACX,CAAG;AACDA,wBAAI,sBAAsB,IAAI;AAAA,EAC9B;AAAA;AAAA,EAED,OAAO,YAAY,OAAM;AAAA,EA4CxB;AAAA;AAAA,EAED,iBAAiB,GAAE;AAClB,QAAI,WAAY,EAAE,KAAK,KAAK,SAAS;AACrC,QAAI,QAAQ;AACZ,QAAG,EAAE,MAAM,SAAS,GAAE;AACrB,cAAQ,EAAE,MAAM,CAAC,EAAE,SAAS,IAAI,UAAU;AAAA,IAC1C;AACD,WAAO;AAAA,MACN,IAAG,EAAE;AAAA,MACL,SAAQ,EAAE;AAAA,MACV,UAAS,EAAE,KAAK;AAAA,MAChB,SAAQ,EAAE,KAAK;AAAA,MACf,UAAS,EAAE;AAAA,MACX;AAAA,MACA,OAAM,EAAE;AAAA,MACR,UAAS,EAAE;AAAA,MACX,OAAM;AAAA,QACL,MAAK;AAAA,QACL,aAAY,EAAE;AAAA,QACd,gBAAe,EAAE;AAAA,MACjB;AAAA,MACD,eAAc,EAAE;AAAA,MAChB,aAAY,EAAE;AAAA,IACd;AAAA,EACD;AAAA;AAAA,EAED,UAAU,KAAI,OAAM;AACnB,QAAI,SAAS,GAAG;AACf,UAAI,QAAQ,IAAI,OAAO,OAAM,CAAC,EAAE,CAAC,CAAC;AAAA,IAClC;AACD,WAAO;AAAA,EACP;AAAA;AAAA,EAED,eAAe,KAAI;AAEjB,QAAI,IAAI,QAAQ,IAAI,UAAU,GAAG;AAChC,aAAO;AAAA,QACN,IAAI,IAAI,KAAK;AAAA,QACb,UAAU,IAAI,KAAK,YAAY,IAAI;AAAA,QACnC,SAAS,IAAI,KAAK,WAAW,IAAI;AAAA,QACjC,OAAO,IAAI,KAAK;AAAA,QAChB,OAAO,IAAI,KAAK;AAAA,QAChB,QAAQ,IAAI,KAAK;AAAA,QACjB,aAAa,IAAI,KAAK;AAAA,QACtB,WAAW,IAAI;AAAA,QACf,UAAS,IAAI,KAAK;AAAA,QAClB,OAAO,IAAI;AAAA,QACX,UAAU;AAAA,UACT,IAAI,IAAI,KAAK,SAAS;AAAA,UACtB,SAAS,IAAI,KAAK,SAAS;AAAA,UAC3B,KAAK,IAAI,KAAK,SAAS;AAAA,UACvB,KAAK,IAAI,KAAK,SAAS;AAAA,UACvB,IAAI,IAAI,KAAK,SAAS;AAAA,UACtB,KAAK,IAAI,KAAK,SAAS;AAAA,UACvB,MAAM,IAAI,KAAK,SAAS;AAAA,UACxB,UAAU,IAAI,KAAK,SAAS;AAAA,QAC5B;AAAA,MACD;AAAA,IACD;AAED,WAAO;AAAA,MACN,IAAI,IAAI;AAAA,MACR,UAAU,IAAI;AAAA,MACd,SAAS,IAAI;AAAA,MACb,OAAO;AAAA,MACP,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,aAAa;AAAA,MACb,WAAW,IAAI;AAAA,MACf,OAAO,IAAI;AAAA,MACX,UAAU;AAAA,IACV;AAAA,EACD;AACH;;"}