{"version":3,"file":"request.js","sources":["common/request.js"],"sourcesContent":["import $C from '@/common/config.js'\r\nimport $store from '@/store/index.js'\r\n\r\nexport default {\r\n\tcommon:{\r\n\t\tmethod:'GET',\r\n\t\theader:{\r\n\t\t\t\"content-type\":\"application/json\"\r\n\t\t},\r\n\t\tdata:{}\r\n\t},\r\n\trequest(options = {}) {\r\n\t\t// 返回 Promise\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\toptions.url = $C.webUrl + options.url;\r\n\t\t\toptions.method = options.method || this.common.method;\r\n\t\t\toptions.header = options.header || this.common.header;\r\n\t\t\t\r\n\t\t\t// 验证权限token\r\n\t\t\tif(options.token) {\r\n\t\t\t\toptions.header.token = $store.state.token\r\n\t\t\t\tif(!options.noCheck && !options.header.token && !options.notoast) {\r\n\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\ttitle:'非法token，请重新登录',\r\n\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 添加成功/失败回调\r\n\t\t\toptions.success = (res) => resolve(res);\r\n\t\t\toptions.fail = (err) => {\n                uni.showToast({\n                    title: '网络连接失败',\n                    icon: 'none'\n                });\n                reject({\n                    code: -1,\n                    msg: '网络异常',\n                    raw: err\n                })\n            };\r\n\t\t\t\r\n\t\t\tuni.request(options);\r\n\t\t});\r\n\t},\r\n\tget(url,data = {},options = {}){\r\n\t\toptions.url = url\r\n\t\toptions.data = data\r\n\t\toptions.method = 'GET'\r\n\t\treturn this.request(options)\r\n\t},\r\n\t\r\n\tpost(url,data = {},options = {}){\r\n\t\toptions.url = url\r\n\t\toptions.data = data\r\n\t\toptions.method = 'POST'\r\n\t\treturn this.request(options)\r\n\t},\r\n\t\r\n\tupload(url,options = {}){\r\n\t\t\toptions.url = $C.webUrl + url\r\n\t\t\toptions.header = options.header || {}\r\n\t\t\t// 验证权限token\r\n\t\t\tif(options.token){\r\n\t\t\t\toptions.header.token = $store.state.token\r\n\t\t\t\tif(!options.header.token){\r\n\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\ttitle: '非法token,请重新登录',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn new Promise((res,rej)=>{\r\n\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t...options,\r\n\t\t\t\t\tsuccess: (uploadFileRes) => {\r\n\t\t\t\t\t\tif(uploadFileRes.statusCode !== 200){\r\n\t\t\t\t\t\t\treturn uni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '上传图片失败',\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet data = JSON.parse(uploadFileRes.data)\r\n\t\t\t\t\t\tres(data)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail:(err)=>{\r\n\t\t\t\t\t\trej(err)\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t\r\n\t\t}\r\n}"],"names":["$C","$store","uni"],"mappings":";;;;AAGA,MAAe,KAAA;AAAA,EACd,QAAO;AAAA,IACN,QAAO;AAAA,IACP,QAAO;AAAA,MACN,gBAAe;AAAA,IACf;AAAA,IACD,MAAK,CAAE;AAAA,EACP;AAAA,EACD,QAAQ,UAAU,IAAI;AAErB,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvC,cAAQ,MAAMA,cAAAA,GAAG,SAAS,QAAQ;AAClC,cAAQ,SAAS,QAAQ,UAAU,KAAK,OAAO;AAC/C,cAAQ,SAAS,QAAQ,UAAU,KAAK,OAAO;AAG/C,UAAG,QAAQ,OAAO;AACjB,gBAAQ,OAAO,QAAQC,YAAM,MAAC,MAAM;AACpC,YAAG,CAAC,QAAQ,WAAW,CAAC,QAAQ,OAAO,SAAS,CAAC,QAAQ,SAAS;AACjE,iBAAOC,cAAAA,MAAI,UAAU;AAAA,YACpB,OAAM;AAAA,YACN,MAAK;AAAA,UACX,CAAM;AAAA,QACD;AAAA,MACD;AAGD,cAAQ,UAAU,CAAC,QAAQ,QAAQ,GAAG;AACtC,cAAQ,OAAO,CAAC,QAAQ;AACXA,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,MAAM;AAAA,QAC1B,CAAiB;AACD,eAAO;AAAA,UACH,MAAM;AAAA,UACN,KAAK;AAAA,UACL,KAAK;AAAA,QACzB,CAAiB;AAAA,MACjB;AAEGA,0BAAI,QAAQ,OAAO;AAAA,IACtB,CAAG;AAAA,EACD;AAAA,EACD,IAAI,KAAI,OAAO,CAAA,GAAG,UAAU,CAAA,GAAG;AAC9B,YAAQ,MAAM;AACd,YAAQ,OAAO;AACf,YAAQ,SAAS;AACjB,WAAO,KAAK,QAAQ,OAAO;AAAA,EAC3B;AAAA,EAED,KAAK,KAAI,OAAO,CAAA,GAAG,UAAU,CAAA,GAAG;AAC/B,YAAQ,MAAM;AACd,YAAQ,OAAO;AACf,YAAQ,SAAS;AACjB,WAAO,KAAK,QAAQ,OAAO;AAAA,EAC3B;AAAA,EAED,OAAO,KAAI,UAAU,IAAG;AACtB,YAAQ,MAAMF,iBAAG,SAAS;AAC1B,YAAQ,SAAS,QAAQ,UAAU,CAAE;AAErC,QAAG,QAAQ,OAAM;AAChB,cAAQ,OAAO,QAAQC,YAAM,MAAC,MAAM;AACpC,UAAG,CAAC,QAAQ,OAAO,OAAM;AACxB,eAAOC,cAAAA,MAAI,UAAU;AAAA,UACpB,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAM;AAAA,MACD;AAAA,IACD;AAED,WAAO,IAAI,QAAQ,CAAC,KAAI,QAAM;AAC7BA,oBAAAA,MAAI,WAAW;AAAA,QACd,GAAG;AAAA,QACH,SAAS,CAAC,kBAAkB;AAC3B,cAAG,cAAc,eAAe,KAAI;AACnC,mBAAOA,cAAAA,MAAI,UAAU;AAAA,cACpB,OAAO;AAAA,cACP,MAAM;AAAA,YACd,CAAQ;AAAA,UACD;AACD,cAAI,OAAO,KAAK,MAAM,cAAc,IAAI;AACxC,cAAI,IAAI;AAAA,QACR;AAAA,QACD,MAAK,CAAC,QAAM;AACX,cAAI,GAAG;AAAA,QACP;AAAA,MACN,CAAK;AAAA,IACL,CAAI;AAAA,EAED;AACH;;"}