{"version":3,"file":"upload-image.js","sources":["components/common/upload-image.vue","../../AppGallery/HBuilderX.4.75.2025070414-alpha/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RjovcHJvamVjdC_npL7ljLrkuqTlj4svY29tcG9uZW50cy9jb21tb24vdXBsb2FkLWltYWdlLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"px-2\">\r\n\t\t<view class=\"uni-uploader\" v-if=\"show\">\r\n\t\t\t<view class=\"uni-uploader-head\">\r\n\t\t\t\t<view class=\"uni-uploader-title\">点击可预览选好的图片</view>\r\n\t\t\t\t<view class=\"uni-uploader-info\">{{imageList.length}}/9</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"uni-uploader-body\">\r\n\t\t\t\t<view class=\"uni-uploader__files\">\r\n\t\t\t\t\t<block v-for=\"(image,index) in imageList\" :key=\"index\">\r\n\t\t\t\t\t\t<view class=\"uni-uploader__file position-relative\">\r\n\t\t\t\t\t\t\t<image class=\"uni-uploader__img rounded\" :src=\"image.url\" :data-src=\"image.url\" \r\n\t\t\t\t\t\t\t@tap=\"previewImage\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t<view class=\"position-absolute top-0 right-0 px-1 rounded\" \r\n\t\t\t\t\t\t\tstyle=\"background-color: rgba(0, 0, 0, 0.3);\" @click.stop=\"deleteImage(index)\">\r\n\t\t\t\t\t\t\t\t<text class=\"iconfont icon-guanbi1 text-white\"></text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t\t<view class=\"uni-uploader__input-box rounded\">\r\n\t\t\t\t\t\t<view class=\"uni-uploader__input\" @tap=\"chooseImage\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script>\r\n\timport permision from \"@/common/permission.js\"\r\n\tvar sourceType = [\r\n\t\t['camera'],\r\n\t\t['album'],\r\n\t\t['camera', 'album']\r\n\t]\r\n\tvar sizeType = [\r\n\t\t['compressed'],\r\n\t\t['original'],\r\n\t\t['compressed', 'original']\r\n\t]\r\n\texport default {\r\n\t\tprops:{\r\n\t\t\tlist:Array,\r\n\t\t\tshow:{\r\n\t\t\t\ttype:Boolean,\r\n\t\t\t\tdefault:true\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: 'choose/previewImage',\r\n\t\t\t\timageList: [],\r\n\t\t\t\tsourceTypeIndex: 2,\r\n\t\t\t\tsourceType: ['拍照', '相册', '拍照或相册'],\r\n\t\t\t\tsizeTypeIndex: 2,\r\n\t\t\t\tsizeType: ['压缩', '原图', '压缩或原图'],\r\n\t\t\t\tcountIndex: 8,\r\n\t\t\t\tcount: [1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tlist: {\r\n\t\t\t\timmediate: true, // 立即执行一次\r\n\t\t\t\thandler(newVal) {\r\n\t\t\t\t\tthis.imageList = newVal;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\t\tthis.sourceTypeIndex = 2,\r\n\t\t\t\tthis.sourceType = ['拍照', '相册', '拍照或相册'],\r\n\t\t\t\tthis.sizeTypeIndex = 2,\r\n\t\t\t\tthis.sizeType = ['压缩', '原图', '压缩或原图'],\r\n\t\t\t\tthis.countIndex = 8;\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t//删除图片\r\n\t\t\tdeleteImage(index) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle:'提示',\r\n\t\t\t\t\tcontent:'是否要删除该图片',\r\n\t\t\t\t\tshowCancel:true,\r\n\t\t\t\t\tcancelText:'不删除',\r\n\t\t\t\t\tconfirmText:'删除',\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tthis.imageList.splice(index,1),\r\n\t\t\t\t\t\t\tthis.$emit('change',this.imageList)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tchooseImage: async function() {\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\t// TODO 选择相机或相册时 需要弹出actionsheet，目前无法获得是相机还是相册，在失败回调中处理\r\n\t\t\t\tif (this.sourceTypeIndex !== 2) {\r\n\t\t\t\t\tlet status = await this.checkPermission();\r\n\t\t\t\t\tif (status !== 1) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\tif (this.imageList.length === 9) {\r\n\t\t\t\t\tlet isContinue = await this.isFullImg();\r\n\t\t\t\t\tconsole.log(\"是否继续?\", isContinue);\r\n\t\t\t\t\tif (!isContinue) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tsourceType: sourceType[this.sourceTypeIndex],\r\n\t\t\t\t\tsizeType: sizeType[this.sizeTypeIndex],\r\n\t\t\t\t\tcount: this.imageList.length + this.count[this.countIndex] > 9 ? 9 - this.imageList.length : this.count[this.countIndex],\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t// 上传图片\r\n\t\t\t\t\t\tres.tempFilePaths.forEach(item=>{\r\n\t\t\t\t\t\t\tthis.$H.upload('/image/uploadmore',{\r\n\t\t\t\t\t\t\t\tfilePath: item,\r\n\t\t\t\t\t\t\t\tname: 'imaglist[]',\r\n\t\t\t\t\t\t\t\ttoken:true\r\n\t\t\t\t\t\t\t}).then(result=>{\r\n\t\t\t\t\t\t\t\tthis.imageList.push(result.data.list[0])\r\n\t\t\t\t\t\t\t\tthis.$emit('change',this.imageList)\r\n\t\t\t\t\t\t\t}).catch(err=>{\r\n\t\t\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\t\t\tif (err['code'] && err.code !== 0 && this.sourceTypeIndex === 2) {\r\n\t\t\t\t\t\t\tthis.checkPermission(err.code);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t// #ifdef MP\r\n\t\t\t\t\t\tuni.getSetting({\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tlet authStatus = false;\r\n\t\t\t\t\t\t\t\tswitch (this.sourceTypeIndex) {\r\n\t\t\t\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\t\t\t\tauthStatus = res.authSetting['scope.camera'];\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\t\t\t\tauthStatus = res.authSetting['scope.album'];\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t\t\t\tauthStatus = res.authSetting['scope.album'] && res.authSetting['scope.camera'];\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (!authStatus) {\r\n\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '授权失败',\r\n\t\t\t\t\t\t\t\t\t\tcontent: 'Hello uni-app需要从您的相机或相册获取图片，请在设置界面打开相关权限',\r\n\t\t\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tuni.openSetting()\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tisFullImg: function() {\r\n\t\t\t\treturn new Promise((res) => {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: \"已经有9张图片了,是否清空现有图片？\",\r\n\t\t\t\t\t\tsuccess: (e) => {\r\n\t\t\t\t\t\t\tif (e.confirm) {\r\n\t\t\t\t\t\t\t\tthis.imageList = [];\r\n\t\t\t\t\t\t\t\tres(true);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tres(false)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\tres(false)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tpreviewImage: function(e) {\r\n\t\t\t\tvar current = e.target.dataset.src\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent: current,\r\n\t\t\t\t\turls: this.imageList\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync checkPermission(code) {\r\n\t\t\t\tlet type = code ? code - 1 : this.sourceTypeIndex;\r\n\t\t\t\tlet status = permision.isIOS ? await permision.requestIOS(sourceType[type][0]) :\r\n\t\t\t\t\tawait permision.requestAndroid(type === 0 ? 'android.permission.CAMERA' :\r\n\t\t\t\t\t\t'android.permission.READ_EXTERNAL_STORAGE');\r\n\r\n\t\t\t\tif (status === null || status === 1) {\r\n\t\t\t\t\tstatus = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: \"没有开启权限\",\r\n\t\t\t\t\t\tconfirmText: \"设置\",\r\n\t\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\tpermision.gotoAppSetting();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn status;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.cell-pd {\r\n\t\tpadding: 22upx 30upx;\r\n\t}\r\n\r\n\t.list-pd {\r\n\t\tmargin-top: 50upx;\r\n\t}\r\n</style>\n","import Component from 'F:/project/社区交友/components/common/upload-image.vue'\nwx.createComponent(Component)"],"names":["uni","res","permision"],"mappings":"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"}