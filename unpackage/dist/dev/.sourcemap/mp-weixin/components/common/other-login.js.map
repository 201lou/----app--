{"version":3,"file":"other-login.js","sources":["components/common/other-login.vue","../../AppGallery/HBuilderX.4.75.2025070414-alpha/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RjovcHJvamVjdC_npL7ljLrkuqTlj4svY29tcG9uZW50cy9jb21tb24vb3RoZXItbG9naW4udnVl"],"sourcesContent":["<template>\r\n\t<!-- #ifdef APP-PLUS || MP-ALIPAY -->\r\n\t<view class=\"flex-1 flex align-center justify-center\"\r\n\tv-for=\"(item,index) in providerList\" :key=\"index\"\r\n\t@click=\"login(item)\">\r\n\t\t<view :class=\"item.icon + ' '+item.bgColor\" class=\"iconfont font-lg text-white flex align-center justify-center rounded-circle\" style=\"width: 100rpx;height: 100rpx;\"></view>\r\n\t</view>\r\n\t<!-- #endif -->\r\n\t\r\n\t<!-- #ifdef MP-WEIXIN -->\r\n\t<button type=\"primary\" open-type=\"getUserInfo\" @getuserinfo=\"mpGetUserInfo\">微信登录</button>\r\n\t<!-- #endif -->\r\n\t<!-- <view class=\"flex align-center justify-center px-2 py-3\">\r\n\t\t\t<view class=\"flex-1 flex align-center justify-center\" \r\n\t\t\tv-for=\"(item,index) in providerList\" :key=\"index\" @click=\"login(item)\">\r\n\t\t\t\t<view :class=\"item.icon + ' '+item.bgColor\" \r\n\t\t\t\tclass=\"iconfont font-lg text-white flex align-center justify-center rounded-circle\"\r\n\t\t\t\tstyle=\"width: 100rpx;height: 100rpx;\"></view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t</view> -->\n</template>\n\n<script>\r\n\texport default {\r\n\t\tprops: {\r\n\t\t\tback: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tproviderList: []\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tuni.getProvider({\r\n\t\t\t\tservice: 'oauth',\r\n\t\t\t\tsuccess: (result) => {\r\n\t\t\t\t\tthis.providerList = result.provider.map((value) => {\r\n\t\t\t\t\t\tlet providerName = '';\r\n\t\t\t\t\t\tlet icon = ''\r\n\t\t\t\t\t\tlet bgColor = ''\r\n\t\t\t\t\t\tswitch (value) {\r\n\t\t\t\t\t\t\tcase 'weixin':\r\n\t\t\t\t\t\t\t\tproviderName = '微信登录'\r\n\t\t\t\t\t\t\t\ticon = 'icon-weixin'\r\n\t\t\t\t\t\t\t\tbgColor='bg-success'\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'qq':\r\n\t\t\t\t\t\t\t\tproviderName = 'QQ登录'\r\n\t\t\t\t\t\t\t\ticon = 'icon-qq'\r\n\t\t\t\t\t\t\t\tbgColor = 'bg-primary'\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'sinaweibo':\r\n\t\t\t\t\t\t\t\tproviderName = '新浪微博登录'\r\n\t\t\t\t\t\t\t\ticon = 'icon-weibo'\r\n\t\t\t\t\t\t\t\tbgColor= 'bg-warning'\r\n\t\t\t\t\t\t\t\tbreak;\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tname: providerName,\r\n\t\t\t\t\t\t\ticon:icon,\r\n\t\t\t\t\t\t\tbgColor:bgColor,\r\n\t\t\t\t\t\t\tid: value\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 过滤没有名字的\r\n\t\t\t\t\t}).filter(item => item.name);\r\n\t\t\t\r\n\t\t\t\t},\r\n\t\t\t\tfail: (error) => {\r\n\t\t\t\t\tconsole.log('获取登录通道失败', error);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 登录\r\n\t\t\tlogin(item) {\r\n\t\t\t\tuni.login({\r\n\t\t\t\t\tprovider:item.id,\r\n\t\t\t\t\t// #ifdef MP-ALIPAY\r\n\t\t\t\t\tscopes: 'auth_user',  //支付宝小程序需设置授权类型\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tuni.getUserInfo({\r\n\t\t\t\t\t\t\tprovider:item.id,\r\n\t\t\t\t\t\t\tsuccess: (infoRes) => {\r\n\t\t\t\t\t\t\t\tlet obj = {\r\n\t\t\t\t\t\t\t\t\tprovider:item.id,\r\n\t\t\t\t\t\t\t\t\topenid:infoRes.userInfo.openId,\r\n\t\t\t\t\t\t\t\t\texpires_in:0,\r\n\t\t\t\t\t\t\t\t\tnickName:infoRes.userInfo.nickName,\r\n\t\t\t\t\t\t\t\t\tavatarUrl:infoRes.userInfo.avatarUrl\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.loginEvent(obj)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle:'登录失败',\r\n\t\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 登录事件\r\n\t\t\tloginEvent(data) {\r\n\t\t\t\tthis.$H.post('/user/otherlogin',data).then(res=>{\r\n\t\t\t\t\t// 修改vuex的state,持久化存储\r\n\t\t\t\t\tthis.$store.commit('login',this.$U.formatUserinfo(res.data.data))\r\n\t\t\t\t\tif(this.back) {\r\n\t\t\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\t\t\tdelta:1\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle:'登录成功',\r\n\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\tmpGetUserInfo(result) {\r\n\t\t\t\tuni.showLoading({ title: '登录中...', mask: true });\r\n\t\t\t\t// 获取失败\r\n\t\t\t\tif (result.detail.errMsg !== 'getUserInfo:ok') {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: '获取用户信息失败',\r\n\t\t\t\t\t\tcontent: '错误原因' + result.detail.errMsg,\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet userinfo = result.detail.userInfo;\r\n\t\t\t\tuni.login({\r\n\t\t\t\t\tprovider:\"weixin\",\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tthis.MpLogin({\r\n\t\t\t\t\t\t\turl:\"/wxlogin\",\r\n\t\t\t\t\t\t\tcode:res.code,\r\n\t\t\t\t\t\t\tnickName:userinfo.nickName,\r\n\t\t\t\t\t\t\tavatarUrl:userinfo.avatarUrl\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// #endif\r\n\t\t\tMpLogin(options){\r\n\t\t\t\tthis.$H.post(options.url,{\r\n\t\t\t\t\tcode:options.code,\r\n\t\t\t\t\tnickName:options.nickName,\r\n\t\t\t\t\tavatarUrl:options.avatarUrl\r\n\t\t\t\t}).then(data=>{\r\n\t\t\t\t\t// 修改vuex的state,持久化存储\r\n\t\t\t\t\tthis.$store.commit('login',this.$U.formatUserinfo(data))\r\n\t\t\t\t\t// 返回上一页\r\n\t\t\t\t\tif(this.back){\r\n\t\t\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\t\t\tdelta: 1\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '登录成功',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t}\r\n\t}\n</script>\n\n<style>\n</style>","import Component from 'F:/project/社区交友/components/common/other-login.vue'\nwx.createComponent(Component)"],"names":["uni"],"mappings":"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"}